<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0079)http://www.phpform.org/formbuilder/view.php?id=52ca8c2df0bcfc44b49f068b17465303 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Experimento de completar palabras</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}view.css" media="all">
<script src="{{ STATIC_URL }}jquery.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}jquery.cookie.js" type="text/javascript"></script>

<script>

function trial_default(){

	//Escondo el texto
	{% for indice in cant_textos %}
		$("#texto{{indice}}").hide();
	{% endfor %}
		
	$("#texto").hide();
	
	//Oculto boton siguiente trial
	$("#boton_siguiente_trial").hide();
	
	//Cargo log
    $("#log").hide()

	$("#log").html(  $("#log").html() + "<br> Se llamo: trial_default");


	if ({{initial_trial}}) {
            
		$("#formulario_inicio").show();            
                $("#formulario_preguntas").hide(); 
                $("#boton_sin_preguntas").show(); 
            
                {% if primer_trial %} 
                    $("#boton_sin_preguntas").hide(); 
                    $("#formulario_preguntas").show();
                {% endif %}
            //~ $("#input_iniciar_trial").focus();

		
        }else {
            trial_inicio();
        }
}

//Inicio tiempo
function trial_inicio(){
	//Cargo tiempo inicial
	var currentDate = new Date();	
	tiempo_inicial = currentDate.getTime();	
	
	//Borro boton de inicio
	$("#formulario_inicio").html("")
	$("#formulario_preguntas").html("")
        $("#formulario_preguntas").hide(); 
	
	$("#texto").show()
	
	//Muestro texto, llevandolo al texto_acumulado
	$("#texto_acumulado").html(  $("#texto0").html() )
	
	//Pongo ahi el foco
	$("#texto0_input").focus()
	
	//Cargo log
        $("#log").hide()
	$("#log").html(  $("#log").html() + "<br> Se llamo: trial_inicio")
	$("#log").html(  $("#log").html() + "<br> Tiempo inicial:"+tiempo_inicial)

	}

	
function trial_inicio_preguntas(){
    console.log("diego")
    $.get("/trial/subirInformation/", {
        'email': '{{usuario}}',
        'native_language': document.forms[1].native_language.value,
        'country': document.forms[1].country.value,
        'schooling':document.forms[1].schooling.value,
        'reading_language': document.forms[1].reading_language.value,
        'books': document.forms[1].books.value,
        'work_reading_language': document.forms[1].work_reading_language.value,
        'work_reading': document.forms[1].work_reading.value,
        'computer_reading': document.forms[1].computer_reading.value,
        'dexterity': document.forms[1].dexterity.value,
        'source': document.forms[1].source.value,
        'other_experiments': document.forms[1].other_experiments.value,
        });
    trial_inicio();

}
function arreglo_valor_inputs(texto_num){
	//cargo las palabras posta, hasta donde llego a completar
	
	{% for indice_palabra in secuencia_posta %}
		if ({{indice_palabra.0}} <= texto_num) 
			$("#texto{{indice_palabra.0}}_input").val("{{indice_palabra.1}}");
	{% endfor %}
}

function texto_input_cambio(event,texto_num){
	
	//Cargo letra
	if (document.all){
		letra = event.keyCode
	}
	else{
		letra = event.which
	}
	
	//Apreto enter
	if (letra==13){

		palabra = $("#texto"+texto_num+"_input").val();
		tam_palabra = $.trim(palabra).length;
		
		//Cargo palabra nueva
		palabras_valor[texto_num] = palabra;
		
		//Sigo adentro del texto
		if ( parseInt(texto_num)<= {{cant_pal}}  && tam_palabra>0){
			
			//Cargo nuevo tiempo para la palabra nueva
			var currentDate = new Date();	
			tiempos[texto_num]= currentDate.getTime();	

			//Cargo log
			$("#log").html(  $("#log").html() + "<br> Enter en texto_num: " +texto_num + " con valor:"+palabra+" tiempo:"+tiempos[texto_num])

			{% for indice_palabra in secuencia_posta %}
                            if ({{indice_palabra.0}} <= texto_num) 
								palabra_original = "{{indice_palabra.1}}";
            {% endfor %}
                       
            porcentaje_avance = parseInt(100*(texto_num)/{{cant_pal}})
			$("#log-publico").html( "<b> Porcentaje Avanzado: </b>" +  porcentaje_avance + "%"  + "<br/>");
			
			//Deshabilitamos lo que paso
			$("#texto"+texto_num+"_input").hide();
			//~ $("#texto"+texto_num+"_input").prop('disabled', true);
			
			//Muestro texto, llevandolo al texto_acumulado y le doy foco al nuevo input
			nuevo_indice = parseInt(texto_num)+1;
						
			//Cargo el contenido a agregar (todo eso lo hago para que los divs no pongan espacios)
			contenido_a_agregar= $("#texto"+nuevo_indice).html();
	
			//Borro el texto que acabo de copiar para poner en otro lado
			$("#texto"+texto_num).html("");
				
			//Pongo el contenido que estaba en el cuerpo de texto_acumulado
			$('#texto_acumulado').html(function(index,html){
				return html.replace("<strong>",'');
			});
			$("#texto_acumulado").html($("#texto_acumulado").html() +  '<strong>' +  contenido_a_agregar + "</strong>"  );
			
			//Le recargo el valor del input
			$("#texto"+texto_num+"_input").val(palabra);
						
			//Pongo foco en el nuevo input
			$("#texto"+nuevo_indice+"_input").focus();
			
			//Pongo los valores de  los inputs
			arreglo_valor_inputs( parseInt(texto_num) );
		}	

		// Cada 10, mando a guardar.
		if (parseInt(texto_num) % 10 == 0 && tam_palabra>0  ){
			//Envio datos a la BD
			$.get("/trial/subir/", 
						{
						   'palabras': palabras_valor,
						   'tiempos': tiempos ,
						   'email': '{{usuario}}',
						   'initTime': tiempo_inicial,
						   'trial': {{trial}},
						}
						//
						//, function(){}
			);
		}
		
		//Completo ultimo input
		if (parseInt(texto_num)=={{cant_pal}}  && tam_palabra>0  ){
			//Envio datos a la BD
			$.get("/trial/subir/", 
						{
						   'palabras': palabras_valor,
						   'tiempos': tiempos ,
						   'email': '{{usuario}}',
						   'initTime': tiempo_inicial,
						   'trial': {{trial}},
						}
						//
						//, function(){}
			);

			//Envio datos a la BD
			$("#log").html(  $("#log").html() + "<br>Envio datos BD")
			
			//Habilito boton para siguiente trial
			$("#log").html(  $("#log").html() + "<br>Habilito boton para siguiente trial")
			
			//Muestror boton siguiente trial
			$("#boton_siguiente_trial").show()
			$("#siguiente_trial").focus()
		}
	}
}

//Inicio
tiempo_inicial = -1;
cant_palabras = {{cant_pal}}

//palabras
var palabras_valor = new Array();
var tiempos = new Array();

$().ready(trial_default)

</script>
</head>

<body id="main_body" class="safari">
    <div id="form_container" >
        <form  class="appnitro">
                <div class="form_description">
                <h2>Experimento de completar palabras</h2>
                <p>En este experimento deberás completar la palabra que pensás que viene a continuación en el texto. No hay respuestas correctas o incorrectas</p>
                <p>Usuario logueado: <b>{{usuario}}</b> <br>
                Textos completados: <b>{{etiqueta_trial}}</b></p>
                </div>						
        </form>	
	
        {%if finalizado%} 
            <div id="fin" align=center>
                Gracias por completar todos los textos. De esta forma sumaste más chances para los sorteos por las órdenes de compra. 
            </div>

        {% else %}
            <div id="formulario_inicio" align=center  style ="display:none;">
                <strong> Instrucciones</strong>:
                <p> Durante el experimento deberás leer textos literarios. Cada texto se muestra de a partes, deteniéndose regularmente para que completes con una sola palabra. Luego de completar la palabra deberás apretar enter para que el texto continúe hasta la próxima palabra faltante. En cada texto se deben completar alrededor de 100 palabras. Esto <b>no es una competencia </b> con palabras correctas o incorrectas, deberás completar con la palabra que te parezca que va a continuación. 
                </p>
                <p></p>
                <p>
                Una vez terminado un texto (aproximadamete 20 minutos) podrás cerrar la ventana o seguir con otro texto. En caso de cerrar la ventana podrás volver en otro momento (utilizando el mismo mail) y seguir desde donde estabas (si cerrás antes de terminar un texto no podrás completarlo luego). En total son 10 textos, completá todos los que puedas (¡tendrás más chances de ganar el premio! ¡y nosotros más datos!)
                </p>
                <p><strong>Objetivo del experimento</strong>: </p>
                <p>El objetivo de este experimento es estimar la predictibilidad de una palabra dado el contexto en el que se encuadra. Recordá que <b>simpre</b> se completa con <b>una sola</b> palabra y que esa palabra debe ser aquella que te suene más factible. 
                </p>
                <p>
                <strong>Premios</strong>: </p>
                <p>Se sortearán dos órdenes de compras mensuales por AR$200 en DealExtreme (o paǵina similar con envío gratis) o AR$200 en efectivo a retirar en el Laboratorio de Neurociencias Integrativas, Pabellón I, Facultad de Ciencias Exactas y Naturales, Universidad de Buenos Aires, Argentina. 
                </p>
                <p></p>
                <p>
                ¡Cada texto que hacés suma 10 puntos para el sorteo! Podés completar hasta 10 textos. Si completás todos, ¡te damos 50 puntos extra! Cada texto se debe completar en una única sesión. Podés cerrar la sesión y volver a entrar con el mismo mail y seguir completando otros textos.
                </p>
                <p>

                <p></p>
                <p>
                Este experimento es parte de la tesis de Licenciatura de Bruno Bianchi (Biología - FCEyN - UBA), te pedimos que lo hagas a conciencia, concentrándote por el tiempo que dura el experimento. Intentá leer todo el texto de corrido y no interrumpas la lectura por tiempos prolongados
                </p>
                <p></p>

                <div id="formulario_preguntas" align=center  style ="margin-top:5%; ">
                    <form id="frmPreguntas" action="javascript:trial_inicio_preguntas()" align=center>
                    <p><b>Cuestionario obligaotorio:</b></p>
                    <p>Antes de empezar te vamos a pedir que completes unas preguntas por única vez que nos servirán a la hora de analizar los datos. Una vez finalizada la encuesta podrás empezar con el experimento</p>
                    
                    <p><label align=left class="description">Ingrese su lengua nativa: {{ form.native_language }}</label><br></p>
                    <p><label align=left class="description">Ingrese su pais de Nacimiento {{ form.country }} </label><br></p>
                    <p><label align=left class="description">Nivel educativo maximo alcanzado/en curso {{ form.schooling }} </label><br></p>
                    <p><label align=left class="description">¿Cuántos libros de Literatura General lee por año? {{ form.books }} </label><br> </p> 
                    <p><label align=left class="description">¿En qué idioma lee regularmente Literatura General? {{form.reading_language }} </label><br></p>
                    <p><label align=left class="description">¿Lee por trabajo? {{ form.work_reading }} </label><br> </p> 
                    <p><label align=left class="description">¿En qué idioma lee regularmente por trabajo? (No obligatoria	) {{form.work_reading_language }} </label><br></p>
                    <p><label align=left class="description">¿Lee habitualmente en la computadora? {{ form.computer_reading }} </label><br> </p> 
                    <p><label align=left class="description">Para escribir, usted es: {{ form.dexterity }} </label><br> </p> 
                    <p><label align=left class="description">¿Cómo llegó al experimento? {{ form.source }} </label><br> </p> 
                    <p><label align=left class="description">¿Queres participar de otros experimentos parecidos? {{ form.other_experiments }} </label><br> </p> 

                    <input id="input_iniciar_trial_preguntas" type="submit"  value="Empezar Experimento">
                    </form> 
                </div>	

                <p>
                ¡Gracias por tu participación!
                </p>
                <p>Consultas y comentarios: experimentolni@gmail.com</p>


                <div id="boton_sin_preguntas" align=center  style ="margin-top:5%; ">
                    <form action="javascript:trial_inicio()" align=center>
                        <input id="input_iniciar_trial" type="submit"  value="Empezar Experimento">
                    </form>	
                </div>
            </div>




            <FONT FACE="Courier New" SIZE=2 >
            <form name="texto_inputs" >
                <div id="texto"  style="margin-top:1%; line-height:200%;">
                    <div id="texto_acumulado" style ="position:relative; font:Times New Roman ;margin-top:2%; width:520px ; margin:auto; text-align:justify; text-justify:inter-word;"></div>
                    {% for texto in texto_con_input %}
                    <div id="texto{{texto.1}}" style ="display:none; text-align:justify; text-justify:inter-word;">
                        {% for subtexto in texto.0%}
                            {% if forloop.last %}
                                {{subtexto}}
                            {%else %}
                                {{subtexto}}
                                <br>
                            {% endif %}
                        {% endfor%}
                        <input id="texto{{texto.1}}_input" onkeyup="javascript:texto_input_cambio(event,'{{texto.1}}')" size=7> 
                    </div>	
                    {% endfor%}
                    <div id="texto{{texto_final.1}}" style ="display:none; text-align:justify; text-justify:inter-word;">
                        {% for subtexto in texto_final.0%}
                            {% if forloop.last %}
                                {{subtexto}}
                            {%else %}
                                {{subtexto}}
                                <br>
                            {% endif %}
                        {% endfor%}    
                    </div>
                </div>
            </form>
            </font>

            <div id="boton_siguiente_trial" align="center" style="margin-top:10%">
                <form method="get" action="">
                    <input name="initial_trial" value="false" type="hidden">
                    <input name="email" value="{{usuario}}" type="hidden">
                    <input id="siguiente_trial" type="submit" value="Siguiente Texto">
                </form>
            </div>
        {%endif%}
    </div>
    <br>

    <div id="log-publico" align=left style ="position:relative; margin-top:5%; width:400px ; text-align:justify; text-justify:inter-word; margin:auto"><br><hr>
    </div>


    <div id="log" align=left style="margin:auto"><br><hr>
    Log debuggin :</div>
    <br>
    <br>
    <br>
</body>
</html>
